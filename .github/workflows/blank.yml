name: Jira GitHub Deploy Test

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Dummy build
        run: |
          echo "Build step for Jira/GitHub deploy test"
          echo "ì—¬ê¸°ì—ì„œ ì‹¤ì œ ë¹Œë“œ/í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."

  deploy:
    # build ì„±ê³µ í›„ì—ë§Œ ì‹¤í–‰
    needs: build
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # 1) GitHub Deployment ìƒì„±
      - name: Create deployment
        id: create_deployment
        uses: chrnorm/deployment-action@releases/v1
        with:
          token: ${{ secrets.GITHUB_TOKEN }}      # ğŸ”´ í•„ìˆ˜: í† í° ì¶”ê°€
          environment: staging                   # Jiraì— í‘œì‹œë  í™˜ê²½ ì´ë¦„
          ref: ${{ github.sha }}                 # ì–´ë–¤ ì»¤ë°‹ì„ ë°°í¬í•˜ëŠ”ì§€
          initial_status: pending                # ì„ íƒê°’, pending â†’ ë‚˜ì¤‘ì— successë¡œ ì—…ë°ì´íŠ¸

      # 2) Deployment Status ì „ì†¡ (JiraëŠ” ì´ ì´ë²¤íŠ¸ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë°°í¬ë¥¼ ì¸ì‹)
      - name: Set deployment status (success)
        uses: chrnorm/deployment-status@releases/v1
        with:
          token: ${{ secrets.GITHUB_TOKEN }}      # ğŸ”´ ì—¬ê¸°ë„ í† í° í•„ìˆ˜
          state: success
          deployment_id: ${{ steps.create_deployment.outputs.deployment_id }}
          environment_url: https://example.com/staging
          log_url: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
