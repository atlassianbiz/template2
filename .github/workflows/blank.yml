name: Jira GitHub Deploy Test

on:
  push:
    branches:
      - main
  workflow_dispatch:

# GITHUB_TOKEN ê¶Œí•œ â€“ ì´ê±° ì—†ìœ¼ë©´ deployments ëª» ë§Œë“¤ ìˆ˜ ìˆìŒ
permissions:
  contents: read
  deployments: write

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Dummy build
        run: echo "Build for Jira/GitHub deploy test"

      # 1) GitHub Deployment ìƒì„± (JiraëŠ” ì´ ì´ë²¤íŠ¸ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë°°í¬ë¥¼ ì¸ì‹)
      - name: Create deployment
        id: create_deployment
        uses: chrnorm/deployment-action@releases/v1
        with:
          # ğŸ”¹ ë³„ë„ ì‹œí¬ë¦¿ ì•ˆ ë§Œë“¤ê³  GitHubì´ ìë™ ì£¼ëŠ” í† í° ì‚¬ìš©
          token: ${{ github.token }}
          environment: staging
          ref: ${{ github.sha }}

      # 2) Deployment ìƒíƒœ success ë¡œ ì—…ë°ì´íŠ¸
      - name: Set deployment status
        uses: chrnorm/deployment-status@releases/v1
        with:
          token: ${{ github.token }}
          state: success
          deployment_id: ${{ steps.create_deployment.outputs.deployment_id }}
